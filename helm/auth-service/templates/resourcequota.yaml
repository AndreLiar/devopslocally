{{- if .Values.resourceQuota.enabled }}
apiVersion: v1
kind: ResourceQuota
metadata:
  name: {{ include "auth-chart.fullname" . }}-quota
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "auth-chart.labels" . | nindent 4 }}
spec:
  hard:
    requests.cpu: {{ .Values.resourceQuota.requests.cpu | quote }}
    requests.memory: {{ .Values.resourceQuota.requests.memory | quote }}
    limits.cpu: {{ .Values.resourceQuota.limits.cpu | quote }}
    limits.memory: {{ .Values.resourceQuota.limits.memory | quote }}
    pods: {{ .Values.resourceQuota.pods | quote }}
  scopeSelector:
    matchExpressions:
      - operator: In
        scopeName: PriorityClass
        values: ["{{ .Values.resourceQuota.priorityClass | default "default" }}"]

---
apiVersion: v1
kind: LimitRange
metadata:
  name: {{ include "auth-chart.fullname" . }}-limits
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "auth-chart.labels" . | nindent 4 }}
spec:
  limits:
    - max:
        cpu: {{ .Values.resources.limits.cpu | quote }}
        memory: {{ .Values.resources.limits.memory | quote }}
      min:
        cpu: {{ .Values.resources.requests.cpu | quote }}
        memory: {{ .Values.resources.requests.memory | quote }}
      type: Pod
    - max:
        cpu: {{ .Values.resources.limits.cpu | quote }}
        memory: {{ .Values.resources.limits.memory | quote }}
      min:
        cpu: {{ .Values.resources.requests.cpu | quote }}
        memory: {{ .Values.resources.requests.memory | quote }}
      type: Container
{{- end }}
